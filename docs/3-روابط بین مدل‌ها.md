## 3. روابط بین مدل‌ها

در جنگو، می‌توانید روابط مختلفی بین مدل‌ها تعریف کنید. این روابط به شما این امکان را می‌دهند که داده‌های مختلف را به هم مرتبط کنید و از آن‌ها استفاده کنید.

### 3.1. رابطه یک به یک (One-to-One Relationship)

رابطه یک به یک به این معنی است که یک رکورد در یک مدل با یک رکورد در مدل دیگر مرتبط است. این نوع رابطه معمولاً برای گسترش مدل‌ها استفاده می‌شود.

- برای تعریف این نوع رابطه، از فیلد `OneToOneField` استفاده می‌شود.

**مثال**:

```python
class Profile(models.Model):
    user = models.OneToOneField(User, on_delete=models.CASCADE)
    bio = models.TextField()

class User(models.Model):
    username = models.CharField(max_length=100)
    email = models.EmailField()
```

در این مثال، هر کاربر یک پروفایل منحصر به فرد دارد. فیلد `OneToOneField` تضمین می‌کند که هر کاربر فقط یک پروفایل خواهد داشت.

### 3.2. رابطه یک به چند (One-to-Many Relationship)

رابطه یک به چند، رابطه‌ای است که در آن یک رکورد از یک مدل می‌تواند با چندین رکورد از مدل دیگر مرتبط باشد. در این رابطه، یک رکورد به رکوردهای متعدد دیگر اشاره دارد.

- برای تعریف این نوع رابطه، از فیلد `ForeignKey` استفاده می‌شود.

**مثال**:

```python
class Product(models.Model):
    name = models.CharField(max_length=100)
    category = models.ForeignKey('Category', on_delete=models.CASCADE)

class Category(models.Model):
    name = models.CharField(max_length=100)
```

در این مثال، هر محصول به یک دسته‌بندی خاص مرتبط است. فیلد `ForeignKey` به این معناست که هر محصول می‌تواند به یک دسته‌بندی خاص اشاره داشته باشد، اما یک دسته‌بندی می‌تواند چندین محصول را در خود جای دهد.

### 3.3. رابطه چند به چند (Many-to-Many Relationship)

رابطه چند به چند، زمانی به کار می‌رود که یک رکورد از یک مدل می‌تواند به چند رکورد از مدل دیگر مرتبط شود و بالعکس.

- برای تعریف این نوع رابطه، از فیلد `ManyToManyField` استفاده می‌شود.

**مثال**:

```python
class Author(models.Model):
    name = models.CharField(max_length=100)

class Book(models.Model):
    title = models.CharField(max_length=100)
    authors = models.ManyToManyField(Author)
```

در این مثال، هر کتاب می‌تواند چند نویسنده داشته باشد و هر نویسنده می‌تواند چندین کتاب نوشته باشد. فیلد `ManyToManyField` به‌طور خودکار یک جدول واسط برای ذخیره روابط ایجاد می‌کند.

### 3.4. تنظیمات فیلدهای رابطه‌ای

برای هر کدام از روابط می‌توانید تنظیمات اضافی را برای مشخص کردن نحوه رفتار در شرایط خاص انجام دهید. این تنظیمات شامل نحوه حذف داده‌ها و نحوه نمایش اطلاعات است.

#### 3.4.1. `on_delete`

ویژگی `on_delete` تعیین می‌کند که هنگام حذف یک شی، با اشیای مرتبط چه اتفاقی بیفتد. گزینه‌های مختلفی برای این ویژگی وجود دارد:

- **`CASCADE`**: وقتی شیء اصلی حذف می‌شود، تمام اشیای مرتبط نیز حذف خواهند شد.
- **`SET_NULL`**: وقتی شیء اصلی حذف می‌شود، مقادیر مربوط به آن در اشیای مرتبط به `NULL` تغییر می‌کنند.
- **`SET_DEFAULT`**: مقدار پیش‌فرض برای فیلد تنظیم می‌شود.
- **`PROTECT`**: حذف رکورد را از طریق محدودیت‌های پایگاه داده جلوگیری می‌کند.

**مثال**:

```python
class Book(models.Model):
    title = models.CharField(max_length=100)
    author = models.ForeignKey(Author, on_delete=models.CASCADE)
```

در این مثال، اگر یک `Author` حذف شود، تمامی `Book`‌هایی که به آن نویسنده مرتبط هستند نیز حذف خواهند شد (با استفاده از `CASCADE`).

#### 3.4.2. `related_name`

ویژگی `related_name` این امکان را فراهم می‌کند که نام معکوس رابطه (یعنی نامی که برای دسترسی به اشیای مرتبط استفاده می‌شود) را مشخص کنید.

**مثال**:

```python
class Author(models.Model):
    name = models.CharField(max_length=100)

class Book(models.Model):
    title = models.CharField(max_length=100)
    author = models.ForeignKey(Author, on_delete=models.CASCADE, related_name='books')
```

در این مثال، برای دسترسی به تمامی کتاب‌های یک نویسنده، می‌توانید از `author.books.all()` استفاده کنید.

### 3.5. مدیریت روابط در جنگو

جنگو ابزارهایی برای مدیریت و دسترسی به داده‌های مرتبط فراهم کرده است. به عنوان مثال، می‌توانید به‌راحتی از ویژگی‌هایی مانند `filter`، `exclude` و `all` برای فیلتر کردن و دسترسی به داده‌های مرتبط استفاده کنید.

**مثال**:

```python
# دسترسی به تمامی کتاب‌های یک نویسنده
author = Author.objects.get(id=1)
books = author.books.all()
```

در این مثال، با استفاده از `author.books.all()` تمامی کتاب‌هایی که به نویسنده مورد نظر مرتبط هستند، بازیابی می‌شوند.

---

با استفاده از این روابط و تنظیمات اضافی، می‌توانید مدل‌های پیچیده‌ای را ایجاد کنید و داده‌ها را به شکلی بهینه مدیریت کنید.
