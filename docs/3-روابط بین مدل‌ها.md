## 3. روابط بین مدل‌ها

در جنگو (Django)، روابط بین مدل‌ها به شما این امکان را می‌دهد که داده‌ها را به شکلی سازمان‌دهی کنید که بتوانید اطلاعات مرتبط را به راحتی جستجو و دسترسی پیدا کنید. این روابط به سه نوع اصلی تقسیم می‌شوند: رابطه یک به یک (One-to-One)، رابطه یک به چند (One-to-Many) و رابطه چند به چند (Many-to-Many). در ادامه، به طور مفصل به هر یک از این روابط پرداخته‌ایم.

---

### 3.1. رابطه یک به یک (One-to-One Relationship)

رابطه یک به یک (One-to-One) به این معنی است که یک رکورد از یک مدل، دقیقاً با یک رکورد از مدل دیگر مرتبط است. به عبارت دیگر، هر شیء در مدل اول می‌تواند فقط یک شیء در مدل دوم داشته باشد و برعکس.

#### کاربردها
این نوع رابطه بیشتر زمانی استفاده می‌شود که شما نیاز دارید که اطلاعات اضافی را به مدل اصلی اضافه کنید، مانند گسترش مدل‌ها.

- به عنوان مثال، اگر شما یک مدل `User` دارید و می‌خواهید اطلاعات پروفایل اضافی برای هر کاربر ذخیره کنید، می‌توانید یک مدل `Profile` ایجاد کنید که به صورت یک به یک با مدل `User` مرتبط باشد.

#### مثال:

```python
class Profile(models.Model):
    user = models.OneToOneField(User, on_delete=models.CASCADE)
    bio = models.TextField()

class User(models.Model):
    username = models.CharField(max_length=100)
    email = models.EmailField()
```

در این مثال، هر کاربر (`User`) تنها یک پروفایل دارد. فیلد `OneToOneField` در مدل `Profile` به مدل `User` اشاره می‌کند و این رابطه را ایجاد می‌کند. وقتی که کاربر حذف می‌شود، پروفایل مربوطه نیز حذف خواهد شد زیرا از `on_delete=models.CASCADE` استفاده کرده‌ایم.

---

### 3.2. رابطه یک به چند (One-to-Many Relationship)

رابطه یک به چند (One-to-Many) به این معنی است که یک رکورد از یک مدل می‌تواند به چندین رکورد از مدل دیگر اشاره کند. این رابطه به این صورت است که یک رکورد (در مدل اصلی) به رکوردهای متعددی در مدل مرتبط اشاره دارد.

#### کاربردها
این رابطه معمولاً زمانی به کار می‌رود که شما نیاز به پیوند دادن چندین شیء به یک شیء دیگر دارید. به عنوان مثال، هر محصول می‌تواند به یک دسته‌بندی خاص تعلق داشته باشد، اما هر دسته‌بندی می‌تواند شامل چندین محصول باشد.

#### مثال:

```python
class Product(models.Model):
    name = models.CharField(max_length=100)
    category = models.ForeignKey('Category', on_delete=models.CASCADE)

class Category(models.Model):
    name = models.CharField(max_length=100)
```

در این مثال، مدل `Product` به مدل `Category` از طریق فیلد `ForeignKey` متصل است. هر محصول یک دسته‌بندی دارد، اما یک دسته‌بندی می‌تواند شامل چندین محصول باشد. ویژگی `on_delete=models.CASCADE` به این معناست که اگر دسته‌بندی حذف شود، تمام محصولات مرتبط با آن نیز حذف می‌شوند.

---

### 3.3. رابطه چند به چند (Many-to-Many Relationship)

رابطه چند به چند (Many-to-Many) به این معنی است که چندین رکورد از یک مدل می‌توانند به چندین رکورد از مدل دیگر مرتبط شوند. این رابطه اجازه می‌دهد تا یک رکورد از مدل اول به چندین رکورد از مدل دوم اشاره کند و برعکس.

#### کاربردها
رابطه چند به چند بیشتر زمانی استفاده می‌شود که نیاز دارید که اشیای مختلف از دو مدل به یکدیگر مرتبط شوند و هر شیء در یکی از مدل‌ها می‌تواند با چندین شیء در مدل دیگر مرتبط باشد.

#### مثال:

```python
class Author(models.Model):
    name = models.CharField(max_length=100)

class Book(models.Model):
    title = models.CharField(max_length=100)
    authors = models.ManyToManyField(Author)
```

در این مثال، هر کتاب می‌تواند چندین نویسنده داشته باشد و هر نویسنده می‌تواند چندین کتاب نوشته باشد. استفاده از `ManyToManyField` به طور خودکار یک جدول واسط در پایگاه داده ایجاد می‌کند تا این ارتباط را ذخیره کند.

---

### 3.4. تنظیمات فیلدهای رابطه‌ای

در جنگو، علاوه بر تعریف روابط، می‌توانید تنظیمات مختلفی برای کنترل نحوه رفتار روابط در زمان‌های خاص مانند حذف داده‌ها یا نحوه دسترسی به داده‌های مرتبط، تعیین کنید.

#### 3.4.1. `on_delete`

ویژگی `on_delete` نحوه حذف داده‌های مرتبط را مشخص می‌کند. این ویژگی هنگام حذف یک شیء، مشخص می‌کند که چه اتفاقی باید برای شیء‌های مرتبط بیفتد. گزینه‌های مختلف برای `on_delete` عبارتند از:

- **`CASCADE`**: وقتی شیء اصلی حذف می‌شود، تمام اشیای مرتبط نیز حذف خواهند شد.
- **`SET_NULL`**: وقتی شیء اصلی حذف می‌شود، مقادیر مربوط به آن در اشیای مرتبط به `NULL` تغییر می‌کنند.
- **`SET_DEFAULT`**: وقتی شیء اصلی حذف می‌شود، مقادیر فیلد به مقدار پیش‌فرض تنظیم می‌شود.
- **`PROTECT`**: حذف رکورد را از طریق محدودیت‌های پایگاه داده جلوگیری می‌کند.

#### مثال:

```python
class Book(models.Model):
    title = models.CharField(max_length=100)
    author = models.ForeignKey(Author, on_delete=models.CASCADE)
```

در این مثال، اگر یک `Author` حذف شود، تمام `Book`‌هایی که به آن نویسنده مرتبط هستند نیز حذف خواهند شد زیرا از `on_delete=models.CASCADE` استفاده شده است.

#### 3.4.2. `related_name`

ویژگی `related_name` این امکان را فراهم می‌کند که به شیوه‌ای معکوس به داده‌های مرتبط دسترسی پیدا کنید. به عبارت دیگر، شما می‌توانید از این ویژگی برای دسترسی به اشیای مرتبط از طرف مدل معکوس استفاده کنید.

**مثال**:

```python
class Author(models.Model):
    name = models.CharField(max_length=100)

class Book(models.Model):
    title = models.CharField(max_length=100)
    author = models.ForeignKey(Author, on_delete=models.CASCADE, related_name='books')
```

در این مثال، به‌جای استفاده از `author.book_set.all()` برای دسترسی به تمامی کتاب‌های یک نویسنده، می‌توانید از `author.books.all()` استفاده کنید، زیرا `related_name='books'` را برای فیلد `ForeignKey` تعیین کرده‌ایم.

---

### 3.5. مدیریت روابط در جنگو

جنگو ابزارهایی را برای مدیریت و دسترسی به داده‌های مرتبط فراهم کرده است. این ابزارها شامل متدهای مختلفی هستند که می‌توانید برای فیلتر کردن، مرتب‌سازی یا دسترسی به داده‌های مرتبط استفاده کنید. برخی از این ابزارها عبارتند از:

- `filter`: برای فیلتر کردن داده‌ها بر اساس شرایط خاص.
- `exclude`: برای حذف داده‌ها بر اساس شرایط خاص.
- `all`: برای دسترسی به تمام داده‌های مرتبط.

#### مثال:

```
# دسترسی به تمامی کتاب‌های یک نویسنده
author = Author.objects.get(id=1)
books = author.books.all()
```

در این مثال، با استفاده از `author.books.all()` تمامی کتاب‌هایی که به نویسنده با شناسه 1 مربوط هستند، بازیابی می‌شوند.

---
